# PRD

**项目名称**：运维巡检工具
**编写日期**：2024 年 11 月
**版本号**：1.0
**作者**：周伟军

## 一、背景和目标

基于夜莺监控系统（Nightingale）和 VictoriaMetrics 数据库，通过 PromQL 查询监控数据，查询夜莺上是否有历史告警信息，自动化生成巡检报告。

核心目标：

- 自动化生成巡检报告，支持时间范围和标签过滤。
- 生成可下载的报告（支持 Excel 和 PDF 格式）。
- 支持多项目、分标签生成报告，能够按项目分表展示数据。
- 支持容器化执行工具

## 二、产品功能

### 2.1 数据集成与配置

- **数据源集成**：与现有的夜莺监控系统和 VictoriaMetrics 数据源无缝集成，使用 PromQL 查询监控数据，支持查询并计算 CPU、内存、磁盘、网络等基础指标。
- **标签管理**：利用已有的集群标签（如 `chongqing`）对数据进行过滤，生成该标签下集群的巡检报告。

### 2.2 自动化巡检报告生成

- **时间范围选择**：支持选择不同时间范围生成报告，包括“最近一天”、“最近一周”、“最近一个月”，并支持自定义日期范围。
- **数据查询与分析**：平台自动从 VictoriaMetrics 查询并计算监控数据，生成报告。数据计算包括：
  - CPU 使用率
  - 内存使用情况
  - 磁盘空间使用
  - 网络流量
  - 系统负载等
- **报告内容**：每份报告将包括：
  - 主机名
  - IP 地址
  - 各项监控指标（如 CPU 使用率、内存、磁盘等）
  - 健康状态（是否满足预设标准）
  - 告警信息（若有异常）

### 2.3 Excel 报告支持

- **项目分表**：每个项目（如 `chongqing`）生成一个单独的工作表。每个工作表包括该项目下所有主机的详细巡检数据。
- **报告格式**：报告列标题包括主机名、IP 地址、监控指标、健康状态、告警信息等。
- **汇总表**：可生成一个汇总表，列出所有项目的统计数据，如平均 CPU 使用率、内存使用率等。

## 三、技术需求

- **技术栈**：
  - **开发语言**：Go v1.23.3
  - **cli 工具**：[使用 cli 库](https://github.com/urfave/cli) v2.27.5

## 五、非功能性需求

- **性能**：应支持高并发查询和报告生成
- **可扩展性**：系统架构应支持未来的功能扩展，如增加更多监控项、集成更多数据源。

## 六、风险与挑战

- **数据延迟**：从 VictoriaMetrics 获取数据时可能存在延迟，需要优化查询性能。
- **系统扩展性**：在多项目和多标签的情况下，系统可能面临性能瓶颈，需提前考虑扩展。
- **告警准确性**：确保监控数据的准确性，避免误报和漏报。

## 八、结语

运维巡检工具，通过 PromQL 查询监控数据，查询夜莺上是否有历史告警信息，自动化生成巡检报告。
