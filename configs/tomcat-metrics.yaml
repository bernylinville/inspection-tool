# =============================================================================
# Tomcat 巡检工具 - 指标定义文件
# =============================================================================
#
# 本文件定义了所有 Tomcat 巡检指标的 PromQL 查询表达式和元数据。
# 基于 Categraf exec 插件采集的 Tomcat 监控数据，支持容器和二进制部署。
#
# 指标字段说明:
#   name:           指标唯一标识符（用于代码引用）
#   display_name:   中文显示名称（用于报告展示）
#   query:          PromQL 查询表达式
#   category:       分类（status、info、connection、security、log）
#   label_extract:  从指标标签提取值（可选，支持数组）
#   format:         格式化类型（可选：duration, timestamp）
#   note:           备注说明
#
# =============================================================================

tomcat_metrics:
  # ---------------------------------------------------------------------------
  # 基础运行状态指标 (来自 exec 脚本)
  # ---------------------------------------------------------------------------
  - name: tomcat_up
    display_name: "运行状态"
    query: "tomcat_up"
    category: status
    note: "1=运行中, 0=停止"

  # ---------------------------------------------------------------------------
  # 实例信息指标 (来自 exec 脚本)
  # ---------------------------------------------------------------------------
  - name: tomcat_info
    display_name: "实例信息"
    query: "tomcat_info"
    category: info
    label_extract:
      - port
      - app_type
      - install_path
      - log_path
      - version
      - jvm_config
    note: "从标签提取端口、应用类型、安装路径、日志路径、版本、JVM配置"

  # ---------------------------------------------------------------------------
  # 连接指标 (来自 exec 脚本)
  # ---------------------------------------------------------------------------
  - name: tomcat_connections
    display_name: "当前连接数"
    query: "tomcat_connections"
    category: connection
    note: "当前 HTTP 连接数（仅展示，不告警，无法获取 max_connections）"

  # ---------------------------------------------------------------------------
  # 安全指标 (来自 exec 脚本)
  # ---------------------------------------------------------------------------
  - name: tomcat_non_root_user
    display_name: "非 root 用户启动"
    query: "tomcat_non_root_user"
    category: security
    note: "1=非 root 用户启动（安全）, 0=root 用户启动（存在风险）"

  # ---------------------------------------------------------------------------
  # 运行时间指标 (来自 exec 脚本)
  # ---------------------------------------------------------------------------
  - name: tomcat_uptime_seconds
    display_name: "运行时长"
    query: "tomcat_uptime_seconds"
    category: status
    format: duration
    note: "容器/进程启动后运行的时长（秒）"

  # ---------------------------------------------------------------------------
  # 日志指标 (来自 exec 脚本)
  # ---------------------------------------------------------------------------
  - name: tomcat_last_error_timestamp
    display_name: "最近错误日志时间"
    query: "tomcat_last_error_timestamp"
    category: log
    format: timestamp
    note: "error.log 最后一条错误日志的 Unix 时间戳，0 表示从未有错误日志"
